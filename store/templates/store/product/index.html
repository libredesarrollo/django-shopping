{% extends "master.html" %}
{% load static %}
{% block title %}üõçÔ∏è {{ _('Product List') }}{% endblock %}

{% block content %}

    <div class="container mx-auto px-4 py-8 lg:px-8">
        <div class="lg:grid lg:grid-cols-4 lg:gap-8">
            <aside class="mb-8 lg:mb-0">
                <div class="sticky top-24">
                   
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white">{{ _("Filters") }}</h2>
                    <form class="mt-4 space-y-6" method="get" >
                        <div>
                            <label class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"
                                for="search">{{ _("Search") }}</label>
                            <div class="relative">
                                <input
                                    class="form-input w-full rounded-md border-gray-200 bg-white py-2.5 pl-10 pr-4 text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-800 dark:border-gray-700 dark:text-white"
                                    id="search" name="search" placeholder="{{ _('Search products') }}..."
                                    type="search" value="{{ request.GET.search }}" />
                            </div>
                        </div>
                        <div>
                            <label class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"
                                for="category">{{ _("Category") }}</label>
                            <select
                                class="form-select w-full rounded-md border-gray-200 bg-white text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-800 dark:border-gray-700 dark:text-white"
                                id="category" name="category_id">
                                <option value="">{{ _("All") }}</option>
                                {% for i, c in categories.items %}
                                    <option value="{{ i }}" {% if request.GET.category_id == i|stringformat:"s" %}selected{% endif %}>{{ c }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300">{{ _("Tag") }}</label>
                            <div class="flex flex-wrap gap-2">
                                {% for i, t in tags.items %}
                                    <button type="submit" name="tag_id" value="{{ i }}"
                                        class="rounded-full border px-3 py-1 text-sm transition-colors {% if tag_id == i %}border-primary-500 bg-primary-50 text-primary-600 font-medium{% else %}border-gray-200 text-gray-600 hover:border-primary-500 hover:bg-primary-50 hover:text-primary-600 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-800{% endif %}">
                                        {{ t }}
                                    </button>
                                {% endfor %}
                            </div>
                        </div>
                        <div>
                            <label class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"
                                for="language">{{ _("Language") }}</label>
                            <select
                                class="form-select w-full rounded-md border-gray-200 bg-white text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-800 dark:border-gray-700 dark:text-white"
                                id="language" name="language">
                                <option value="">{{ _("All") }}</option>
                                <option value="english" {% if request.GET.language == "english" %}selected{% endif %}>{{ _("English") }}</option>
                                <option value="spanish" {% if request.GET.language == "spanish" %}selected{% endif %}>{{ _("Spanish") }}</option>
                            </select>
                        </div>
                        <div>
                            <label class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300">{{ _("Date Range") }}</label>
                            <div class="grid grid-cols-2 gap-2">
                                <input
                                    class="form-input w-full rounded-md border-gray-200 bg-white text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-800 dark:border-gray-700 dark:text-white"
                                    type="date" name="from" value="{{ request.GET.from }}" placeholder="{{ _('From') }}" />
                                <input
                                    class="form-input w-full rounded-md border-gray-200 bg-white text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-800 dark:border-gray-700 dark:text-white"
                                    type="date" name="to" value="{{ request.GET.to }}" placeholder="{{ _('To') }}" />
                            </div>
                        </div>
                        <button class='btn btn-success'  type="submit">{{ _('Filter') }}</button>
                        
                    </form>
                
                </div>
            </aside>

            <div class="lg:col-span-3">
                <div class="mb-8 flex flex-wrap items-center justify-between gap-4">
                    <h1 class="text-4xl font-bold text-gray-900 dark:text-white">
                        {{ product_type.title|default:_("All Products") }}
                    </h1>
                  
                </div>

                {% load check_if_exists %}

                {% if template_path %}
                    {% check_if_exists template_path as exists %}
                    {% if exists %}
                        {% include template_path %}
                    {% endif %}

                {% else %}
                    <div class="grid grid-cols-2 gap-x-4 gap-y-8 md:grid-cols-3">
                        {% for p in products %}
                            <a href="{% url 's.p.show' p.product_type.slug p.slug %}"
                                class="group relative flex cursor-pointer flex-col">
                                <div class="relative mb-3 overflow-hidden rounded-md">
                                    <div class="aspect-[3/4] w-full bg-cover bg-center bg-no-repeat transition-transform duration-300 group-hover:scale-105"
                                        style="background-image: url('{{ p.getImageUrl }}'); view-transition-name: {{ p.slug }}">
                                    </div>
                                </div>
                                <div>
                                    <h3
                                        class="text-sm font-semibold text-gray-800 group-hover:text-primary-600 dark:text-gray-200 dark:group-hover:text-primary-400">
                                        {{ p.title }}</h3>
                                    <p class="text-sm font-medium text-gray-500 dark:text-gray-300 ml-3">{{ p.price_offert }}$</p>
                                </div>
                            </a>
                        {% empty %}
                            <div class="col-span-full text-center text-gray-500 dark:text-gray-400">
                                <p>{{ _("No products found.") }}</p>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
                <div class="mt-8">
                    {{ products.paginator }}
                </div>
            </div>
        </div>
    </div>
{% endblock content %}